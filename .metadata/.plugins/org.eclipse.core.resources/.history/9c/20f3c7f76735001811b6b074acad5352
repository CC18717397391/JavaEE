(function() {
  var editor = null;

  //  后台管理页面
  var time = {
    "artical": 0,
    "user": 0,
    "img": 0,
    "createArt": 0
  };
  var TIME_SPACE = 1000;
  $("#articalManager").click(function() {
    if (new Date().getTime() - time.artical < TIME_SPACE) {
      return;
    }
    time.artical = new Date().getTime();
    setTemplate(
      "/iyizhan/src/pc/views/manager/artical.html",
      "#articalManager",
      initArtical
    );
  });
  $("#articalManager").click();
  $("#userManager").click(function() {
    if (new Date().getTime() - time.user < TIME_SPACE) {
      return;
    }
    time.user = new Date().getTime();
    setTemplate("/iyizhan/src/pc/views/manager/user.html", "#userManager", initUser);
  });
  $("#imgManager").click(function() {
    if (new Date().getTime() - time.img < TIME_SPACE) {
      return;
    }
    time.img = new Date().getTime();
    setTemplate("/iyizhan/src/pc/views/manager/img.html", "#imgManager");
  });
  function setTemplate(url, id, callback) {
    $.ajax({
      "type": "get",
      "url": url,
      "success": function(response) {
        $(".right")
          .empty()
          .append(response);
        $(".left>li").removeClass("active");
        $(id).addClass("active");
        callback && callback();
      }
    });
  }

  //  文章管理
  function initArtical() {
    if (editor) {
      editor.destroy();
      editor = null;
    }
    editor = UE.getEditor("editor");
    $("#listArt").show();
    $("#editorArt").hide();
    bindCreate();
    bindOperation();
  }

  function bindCreate() {
    $("#createArtical").on("click", function() {
      $("#listArt").hide();
      $("#editorArt").show();
    });
  }

  function bindOperation() {
    $("#listArt .table").on("click", "td>a", function(e) {
      var artical = $(e.target)
        .parent()
        .attr("artical-id");
      var type = $(e.target).attr("operation");
      if (artical === undefined || type === undefined) {
        return;
      }
      if ("delete" === type) {
        $("#deleteArt").attr("artical-id", artical);
        $("#deleteArt .modal-body").text(
          "是否要删除文章：" +
            $(e.target)
              .parent()
              .parent()
              .children()[0].innerText
        );
        $("#deleteArt").modal("toggle");
      }
      if ("modify" === type) {
        $("#listArt").hide();
        $("#editorArt").show();
      }
    });
    $("#deleteSubmit").click(function() {
      // var artical = $("#deleteArt").attr("artical-id");
      $("#deleteArt").modal("toggle");
    });
  }

  // 学院管理
  function initUser() {
    $("#listUser").show();
    $("#editorUser").hide();
    $("#tempImg").click(function() {
      editor.getDialog("insertimage").open();
    });
  }
})();
