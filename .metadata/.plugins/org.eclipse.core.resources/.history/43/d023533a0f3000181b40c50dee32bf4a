package com.yizhan.login;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import com.yizhan.bean.User;


@Controller		
@RequestMapping("/permission")		//@RequestMapping请求映射，处理请求路径
public class PermissionController {
	
	User user;
	
	//http://localhost:8080/login/validate
	@RequestMapping(value="/login", method=RequestMethod.POST)
	public @ResponseBody Map<String, String> ValidateA(
			@RequestParam(value= "username", required = true) String username,
			@RequestParam(value= "password", required = true) String password,
			HttpSession session) {
		HashMap<String, String> map = new HashMap<String, String>();
		System.out.println("登录进来了，账号是：" + username + "  密码是：" + password);
		if(username.equals("admin") && password.equals("admin123")){
			user = new User();
			user.setUsername(username);
			user.setPassword(password);
			map.put("state", "SUCCESS");
			session.setAttribute("user", user);
		}else{
			map.put("errorMessage", "用户名或密码输入有误！");
			map.put("state", "FAILED");
		}
		return map;
	}
	
	@RequestMapping(value="/login", method=RequestMethod.PUT)
	public @ResponseBody boolean ValidateB(
			@RequestParam(value= "username", required = true) String username,
			@RequestParam(value= "password", required = true) String password
			) {
		System.out.println("登录进来了，账号是：" + username + "  密码是：" + password);
		return true;
	}
	
	
	@RequestMapping(value="/logout", method=RequestMethod.POST)
	public String logout(HttpSession session,HttpServletResponse resp) throws IOException {
		session.invalidate();
		System.out.println("123");
		return "redirect:/login.html"; 
	}
	
	

}
